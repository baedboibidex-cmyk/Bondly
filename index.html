// ðŸ”¥ Clear old service workers
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.getRegistrations()
      .then(registrations => {
        registrations.forEach(registration => registration.unregister());
      })
      .catch(err => {
        console.log("Service worker cleanup failed:", err);
      });
  });
}

// ðŸ” Initialize Firebase auth and database
const auth = firebase.auth();
const db = firebase.firestore();

// ðŸ” SIGN UP
function signup() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const username = document.getElementById("username").value;

  if (!email || !password || !username) {
    alert("Fill all fields");
    return;
  }

  auth.createUserWithEmailAndPassword(email, password)
    .then(userCredential => {
      const user = userCredential.user;

      return db.collection("users").doc(user.uid).set({
        username: username,
        email: email,
        is18Verified: false,   // ðŸ”ž age lock
        isPremium: false,      // ðŸ’³ paywall
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    })
    .then(() => {
      alert("Account created!");
      window.location.href = "matches.html"; // go to Matches page
    })
    .catch(error => {
      alert(error.message);
    });
}

// ðŸ”‘ LOGIN
function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  if (!email || !password) {
    alert("Fill all fields");
    return;
  }

  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      window.location.href = "chat.html"; // go to Chat page
    })
    .catch(error => {
      alert(error.message);
    });
}

// ðŸ›¡ï¸ Optional: keep users logged in without redirect
auth.onAuthStateChanged(user => {
  if (user) {
    console.log("User logged in:", user.email);
    // Do NOT auto-redirect; let user navigate manually
  } else {
    console.log("No user logged in");
  }
});
